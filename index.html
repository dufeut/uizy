<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Uizy Example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>

<body>
    <uizy-app id="app">
        <!-- System Bar -->
        <uizy-system-bar class="d-flex dy-ce bd-b px-3 d-flex dx-sb">
            <span>Uizy Demo</span>
            <ui-box use="badge.status">
                Status: <ui-box :text="app.status"></ui-box>
            </ui-box>
        </uizy-system-bar>

        <!-- Header -->
        <uizy-header shadow="6" class="d-flex dy-ce px-4">
            <ui-box use="button.icon" :click="$emit('drawer.toggleLeft')">
                <span class="">&#9776;</span>
            </ui-box>
            <span class="">Uizy Framework</span>
            <ui-box use="button.icon" :click="$emit('drawer.toggleRight')">
                <span class="">&#9881;</span>
            </ui-box>
        </uizy-header>

        <!-- Left Drawer -->
        <uizy-drawer open shadow="6" clip-top clip-bottom class="d-flex dy-ce p-4">
            <h3 class="mb-4">Navigation</h3>
            <ui-box use="nav.item" :click="$emit('nav.goto', 'home')">Home</ui-box>
            <ui-box use="nav.item" :click="$emit('nav.goto', 'about')">About</ui-box>
            <ui-box use="nav.item" :click="$emit('nav.goto', 'contact')">Contact</ui-box>
            <hr class="my-4 bd-t" />
            <p class="">Current: <ui-box :text="nav.current"></ui-box></p>
        </uizy-drawer>

        <!-- Right Drawer (Settings) -->
        <uizy-drawer right shadow="6" clip-top clip-bottom class="d-flex dy-ce p-4">
            <h3 class="mb-4">Settings</h3>
            <div class="mb-4">
                <label class="d-block mb-2">Theme</label>
                <ui-box use="button.small" :click="$emit('theme.toggle')">
                    Toggle Theme
                </ui-box>
                <p class="mt-2">Current: <ui-box :text="settings.theme"></ui-box></p>
            </div>
        </uizy-drawer>

        <!-- Mini Drawers -->
        <uizy-drawer mini shadow="3" clip-system clip-bottom class="d-flex dy-ce">
            <ui-box class="p-2 ta-c e-p" :click="$emit('drawer.toggleLeft')">
                &#9776;
            </ui-box>
        </uizy-drawer>
        <uizy-drawer right mini shadow="3" clip-system clip-bottom class="">
            <ui-box class="p-2 ta-c e-p" :click="$emit('drawer.toggleRight')">
                &#9881;
            </ui-box>
        </uizy-drawer>

        <!-- Overlay -->
        <uizy-overlay clip-top clip-bottom></uizy-overlay>

        <!-- Main Content -->
        <uizy-main clip-top clip-bottom clip-left clip-right class="d-flex df-col dy-ce">
            <!-- Counter Demo -->
            <div class="mb-6 p-4 br-2">
                <h3 class="mb-3 tt-u" style="color: var(--color-primary)">Reactive Counter</h3>
                <div class="d-flex">
                    <ui-box use="button.primary" :click="$emit('counter.decrement')">-</ui-box>
                    <ui-box use="button.primary" class=" ff-m ta-c" :text="counter.value" style="width: 40px"></ui-box>
                    <ui-box use="button.primary" :click="$emit('counter.increment')">+</ui-box>
                    <ui-box class="ml-8" use="button.secondary" :click="$emit('counter.reset')">Reset</ui-box>
                </div>
            </div>

            <!-- Two-Way Binding Demo -->
            <div class="d-flex df-col dy-ce mb-6 p-4 br-2">
                <h3 class="mb-3 tt-u">Model (directive)</h3>
                <div class="d-flex">
                    <ui-box :model="user.name">
                        <input type="text" class="px-3 py-2 bd-a br-1" placeholder="Enter your name..." />
                    </ui-box>
                </div>
                <p class="mt-3">
                    Hello, <ui-box :text="user.name" class=""></ui-box>!
                </p>
            </div>

            <!-- Event Handlers Demo -->
            <div class="mb-6 p-4 br-2">
                <h3 class="mb-3 tt-u">Event Handlers</h3>
                <div class="d-flex">
                    <ui-box use="button.interactive" :click="console.log('Click!', event)"
                        :mouseenter="el.style.transform = 'scale(1.05)'" :mouseleave="el.style.transform = 'scale(1)'">
                        Hover & Click Me
                    </ui-box>
                    <ui-box use="button.secondary" :dblclick="$emit('notification.show', 'Double clicked!')">
                        Double Click Me
                    </ui-box>
                </div>
            </div>

            <!-- Actions Demo -->
            <div class="mb-6 p-4 br-2">
                <h3 class="mb-3 tt-u">Actions & Global Shortcuts</h3>
                <div class="d-flex">
                    <ui-box use="button.primary" onclick="$emit('user.login', { name: $('user.name') })">
                        Login (using $emit & $)
                    </ui-box>
                    <ui-box use="button.secondary" :click="uizy.emit('notification.show', 'Hello from uizy!')">
                        Show Notification
                    </ui-box>
                </div>
            </div>

            <!-- Custom Directive Demo (using fx plugin) -->
            <div class="mb-6 p-4 br-2">
                <h3 class="mb-3 tt-u">Plugin Directives (fx-*)</h3>
                <div class="d-flex">
                    <ui-box :fx-highlight="yellow" class="p-2">:fx-highlight="yellow"</ui-box>
                    <ui-box :fx-highlight="lightblue" class="p-2">:fx-highlight="lightblue"</ui-box>
                    <ui-box :fx-tooltip.top="This is a tooltip!" use="button.secondary">
                        Hover for Tooltip
                    </ui-box>
                </div>
            </div>

            <!-- Notifications (using fx plugin) -->
            <ui-box :fx-show="notification.visible" class="p-fixed b-5 r-5 px-5 py-3 br-2 s-3 z-10" :fx-fade>
                <ui-box :text="notification.message"></ui-box>
            </ui-box>
        </uizy-main>

        <!-- Footer -->
        <uizy-footer shadow="6" class="px-4 d-flex dy-ce dx-sb">
            <span>Built with Uizy</span>
            <span>v<ui-box :text="app.version" class="d-il"></ui-box></span>
        </uizy-footer>
    </uizy-app>

    <script type="module">
        import uizy from "/src/__init__.js";

        // =====================================================
        // Custom Directives (registered before start)
        // =====================================================

        // :model - Two-way binding for inputs
        uizy.directive("model", (el, { value, effect }) => {
            const input = el.querySelector("input, textarea, select") || el;

            effect(() => {
                const store = uizy.$(value, { raw: true });
                if (!store) return;

                const unsubscribe = store.subscribe((v) => {
                    if (input.value !== String(v)) input.value = String(v);
                });

                const onInput = () => store.set(input.value);
                input.addEventListener("input", onInput);

                return () => {
                    unsubscribe();
                    input.removeEventListener("input", onInput);
                };
            });
        });

        // =====================================================
        // Effects Plugin - Bundles visual effects directives
        // =====================================================
        function EffectsPlugin(app) {
            app.plugin("fx", {
                directives: {
                    // :fx-highlight="color" - Simple styling directive
                    highlight: (el, { value }) => {
                        el.style.backgroundColor = value || "yellow";
                        el.style.padding = el.style.padding || "4px 8px";
                        el.style.borderRadius = "4px";
                    },

                    // :fx-tooltip.top="text" - Tooltip directive with modifiers
                    tooltip: (el, { value, modifiers, cleanup }) => {
                        const tooltip = document.createElement("div");
                        tooltip.textContent = value;
                        tooltip.style.cssText = `
                            position: absolute;
                            background: #333;
                            color: #fff;
                            padding: 6px 12px;
                            border-radius: 4px;
                            font-size: 12px;
                            white-space: nowrap;
                            pointer-events: none;
                            opacity: 0;
                            transition: opacity 0.2s;
                            z-index: 9999;
                        `;
                        document.body.appendChild(tooltip);

                        const position = modifiers.includes("top") ? "top" : "bottom";

                        const show = () => {
                            const rect = el.getBoundingClientRect();
                            tooltip.style.left =
                                rect.left + rect.width / 2 - tooltip.offsetWidth / 2 + "px";
                            tooltip.style.top =
                                position === "top"
                                    ? rect.top - tooltip.offsetHeight - 8 + "px"
                                    : rect.bottom + 8 + "px";
                            tooltip.style.opacity = "1";
                        };

                        const hide = () => {
                            tooltip.style.opacity = "0";
                        };

                        el.addEventListener("mouseenter", show);
                        el.addEventListener("mouseleave", hide);

                        cleanup(() => {
                            el.removeEventListener("mouseenter", show);
                            el.removeEventListener("mouseleave", hide);
                            tooltip.remove();
                        });
                    },

                    // :fx-show="store.path" - Conditional visibility
                    show: (el, { value, effect }) => {
                        effect(() => {
                            const store = app.$(value, { raw: true });
                            if (!store) {
                                el.style.display = value ? "" : "none";
                                return;
                            }
                            return store.subscribe((v) => {
                                el.style.display = v ? "" : "none";
                            });
                        });
                    },

                    // :fx-fade - Fade animation on visibility
                    fade: (el) => {
                        el.style.transition = "opacity 0.3s ease";
                    },
                },
            });
        }

        // =====================================================
        // Start Uizy
        // =====================================================

        uizy.start({
            globals: true, // Enables window.$ and window.$emit

            plugins: [EffectsPlugin],

            layout: {
                layout: {
                    system: 28,
                    header: 56,
                    footer: 48,
                    left: 220,
                    right: 260,
                    leftMini: 48,
                    rightMini: 48,
                    drawerSpeed: 0.25,
                },
                overlay: {
                    opacity: 0.5,
                    color: "black",
                },
                breakpoint: {
                    name: "md",
                    main: true,
                    header: true,
                    left: true,
                    right: true,
                },
            },

            theme: {
                colors: {
                    primary: "#6b08a5",
                    secondary: "#f5f5f5",
                    accent: "#1eadff",
                    focus: "#1eadff",
                    info: "#0050b9",
                    success: "#28b77b",
                    warning: "#f2c94c",
                    danger: "#d64545",
                    error: "#ff4d4d",
                },
                scrollbar: {
                    size: 8,
                    color: "rgba(0, 0, 0, 0.2)",
                    hover: "rgba(0, 0, 0, 0.4)",
                },
                brands: [],
            },

            // Component classes
            components: {
                button: {
                    primary: () => "px-4 py-2 bd-a e-p e-ns",
                    secondary: () => "px-4 py-2 bd-a br-1 e-p e-ns",
                    small: () => "px-3 py-1 bd-a br-1 e-p e-ns text-sm",
                    icon: () => "p-2 e-p e-ns br-1",
                    interactive: () => "px-4 py-2 br-accent e-p e-ns",
                },
                badge: {
                    status: () => "px-2 py-1 br-1 text-xs",
                },
                nav: {
                    item: () => "d-block px-3 py-2 mb-1 br-1 e-p e-ns",
                },
            },

            // Actions
            actions: {
                counter: {
                    increment: () =>
                        uizy.$set("counter.value", uizy.$("counter.value") + 1),
                    decrement: () =>
                        uizy.$set(
                            "counter.value",
                            Math.max(0, uizy.$("counter.value") - 1)
                        ),
                    reset: () => uizy.$set("counter.value", 0),
                },
                drawer: {
                    toggleLeft: () => {
                        const app = uizy.get("app");
                        app?.action("left", ({ set }) => set());
                    },
                    toggleRight: () => {
                        const app = uizy.get("app");
                        app?.action("right", ({ set }) => set());
                    },
                },
                nav: {
                    goto: (page) => {
                        uizy.$set("nav.current", page);
                        console.log("Navigate to:", page);
                    },
                },
                theme: {
                    toggle: () => {
                        const current = uizy.$("settings.theme");
                        uizy.$set(
                            "settings.theme",
                            current === "light" ? "dark" : "light"
                        );
                    },
                },
                user: {
                    login: (data) => {
                        console.log("Login:", data);
                        uizy.emit("notification.show", `Welcome, ${data.name}!`);
                    },
                },
                notification: {
                    show: (message) => {
                        uizy.$set("notification.message", message);
                        uizy.$set("notification.visible", true);
                        setTimeout(() => uizy.$set("notification.visible", false), 3000);
                    },
                },
            },

            // Stores (reactive state)
            stores: {
                app: {
                    status: uizy.store.atom("online"),
                    version: uizy.store.atom("0.1.1"),
                },
                counter: {
                    value: uizy.store.atom(0),
                },
                user: {
                    name: uizy.store.atom("World"),
                },
                nav: {
                    current: uizy.store.atom("home"),
                },
                settings: {
                    theme: uizy.store.atom("light"),
                },
                notification: {
                    visible: uizy.store.atom(false),
                    message: uizy.store.atom(""),
                },
            },

            onReady: () => {
                console.log("Uizy is ready!", window.uizy.__version__);

                // Close overlay on start
                const app = uizy.get("app");
                app?.action("overlay", ({ set }) => set(false));

                //app?.action("left.mini", ({ set }) => set(true));
            },
        });
    </script>
</body>

</html>